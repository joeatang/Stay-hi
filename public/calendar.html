<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Stay Hi ‚Äî Calendar (Redirecting...)</title>
  
  <!-- Simple redirect - no auth needed -->
  <script>
    // Redirect to main app which has the modern calendar modal
    console.log('üìÖ Redirecting to premium calendar system...');
    setTimeout(() => {
      window.location.href = 'index.html?showCalendar=true';
    }, 1500);
  </script>
  
  <link rel="stylesheet" href="assets/theme.css"/>
  <link rel="stylesheet" href="assets/create-parity.css"/>
  <style>
    body{min-height:100dvh;background:linear-gradient(135deg, #2d1e4f 0%, #ff7a18 60%, #ffd166 100%);}
    .wrap{max-width:600px;margin:0 auto;padding:40px 16px;text-align:center}
    .deprecation-notice{
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:20px;
      padding:32px;
      color:#fff;
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
    }
    .spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top:3px solid #ff7a18;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    h1{font-size:24px;margin:0 0 16px 0;font-weight:600}
    p{margin:16px 0;opacity:0.9;line-height:1.6}
  </style>
</head>
<body class="sunrise" data-tab="calendar">
  <main class="wrap">
    <div class="deprecation-notice">
      <h1>üìÖ Upgraded Calendar System</h1>
      <p>This standalone calendar page has been replaced with our premium calendar modal system for a better user experience.</p>
      <div class="spinner"></div>
      <p><strong>Redirecting to the main app...</strong></p>
    </div>
    <h1>Calendar</h1>
    <p class="hint">Shows which days you marked a <b>Self Hi-5</b> and your streak.</p>
    <div id="cal" class="grid" aria-label="This week"></div>
  </main>

  <script src="assets/supabase-init.js"></script>
  <script src="assets/auth.js"></script>
  <script src="assets/db.js"></script>
  <script src="assets/header.js" defer></script>
  <script>
  // Check if we have auth tokens in the URL hash and redirect to post-auth for processing
  if (location.hash && location.hash.includes('access_token')) {
    console.log('üîê Found auth tokens, redirecting to post-auth for processing...');
    location.href = `post-auth.html${location.hash}`;
  } else {
    // Continue with normal initialization
    initCalendar();
  }

  function initCalendar(){
    const cal = document.getElementById('cal');
    const LS = { hist:'hi5.history' };
    function read(k,def){ try{ const v=localStorage.getItem(k); return v==null?def:JSON.parse(v) }catch{ return def } }
    function todayKey(d=new Date()){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}` }
    function monday(d=new Date()){ const x=new Date(d); const w=(x.getDay()+6)%7; x.setDate(x.getDate()-w); x.setHours(0,0,0,0); return x }

    const hist = read(LS.hist,{});
    const start = monday(new Date());
    for(let i=0;i<7;i++){
      const d = new Date(start); d.setDate(start.getDate()+i);
      const k = todayKey(d);
      const el = document.createElement('div');
      el.className = 'day' + ((hist[k]||0)>0 ? ' done':'');
      el.innerHTML = `<div style="font-weight:800">${d.toLocaleDateString(undefined,{weekday:'short'})}</div>
                      <div style="opacity:.85">${d.getMonth()+1}/${d.getDate()}</div>`;
      cal.appendChild(el);
    }
  } // Close initCalendar function
  </script>
</body>
</html>
