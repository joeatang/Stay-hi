<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Auth Guard Test</title>
  <style>
    body { font-family: system-ui; padding: 40px; max-width: 800px; margin: 0 auto; }
    .log { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; white-space: pre-wrap; font-family: monospace; }
    .btn { display: inline-block; padding: 8px 16px; margin: 8px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>üß™ Auth Guard Isolation Test</h1>
  <p>This page loads ONLY the essential auth components to isolate issues.</p>
  
  <div class="log" id="log">Starting test...\n</div>
  
  <div>
    <a href="hi-island-NEW.html" class="btn">Go to Hi-Island</a>
    <a href="profile.html" class="btn">Go to Profile</a>  
    <a href="hi-muscle.html" class="btn">Go to Hi-Muscle</a>
    <a href="index.html" class="btn">Go to Index</a>
  </div>

  <!-- URL Path Fixer -->
  <script src="assets/url-path-fixer.js"></script>
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  
  <!-- Supabase Init -->
  <script src="assets/supabase-init.js"></script>
  
  <!-- Auth Guard with logging -->
  <script src="assets/auth-guard.js?v=4"></script>

  <script>
    const log = document.getElementById('log');
    
    // Capture console logs and display them
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      log.textContent += args.join(' ') + '\n';
      log.scrollTop = log.scrollHeight;
    };
    
    const originalError = console.error;  
    console.error = function(...args) {
      originalError.apply(console, args);
      log.textContent += '‚ùå ERROR: ' + args.join(' ') + '\n';
      log.scrollTop = log.scrollHeight;
    };
    
    console.log('üß™ Test page loaded');
    console.log('üìç Current pathname:', location.pathname);
    console.log('üîó Current href:', location.href);
    
    // Monitor for redirects
    let originalReplace = location.replace;
    location.replace = function(url) {
      console.log('üîÑ REDIRECT ATTEMPT:', url);
      log.textContent += 'üîÑ REDIRECT ATTEMPT: ' + url + '\n';
      return originalReplace.call(location, url);
    };
    
    // Wait and check final state
    setTimeout(() => {
      console.log('‚è∞ 3-second check:');
      console.log('  - Still on test page:', location.pathname.includes('auth-guard-test'));
      console.log('  - userAuthenticated:', window.userAuthenticated);
      console.log('  - demoMode:', window.demoMode);
    }, 3000);
  </script>
</body>
</html>