<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hi Muscle · Stay Hi</title>
  <link rel="stylesheet" href="assets/create-parity.css"/>
</head>
<body class="sunrise">
  <header id="app-header" class="header"></header>

  <main class="page">
    <section class="panel">
      <h1 class="h1">Build Your Hi Muscle</h1>
      <p class="lead">Mock mode — saves to your browser so we can iterate without deploy limits.</p>
      <div id="streaks" class="toast">Loading…</div>
      <div style="margin:10px 0 6px">
        <button id="checkin" class="btn">Check in for Today</button>
      </div>
      <div id="mtoast" class="toast" aria-live="polite"></div>
    </section>

    <section class="panel">
      <h2 class="h1" style="font-size:1.2rem;margin:0 0 10px">Hi Session</h2>
      <p class="lead">Three quick steps — Create-style.</p>
      <div class="bar"><i></i></div>
      <div class="dots"><span class="dot on"></span><span class="dot"></span><span class="dot"></span></div>

      <div class="step on">
        <div class="wheel">
          <div style="font-weight:800;text-align:center">How do you feel<br><small>(now)</small></div>
        </div>
        <select id="feel-now" class="select">
          <option value="">Select one…</option>
          <option>Calm</option><option>Energized</option><option>Grateful</option>
          <option>Stressed</option><option>Tired</option>
        </select>
        <button id="next1" class="btn">Next</button>
      </div>

      <div class="step">
        <div class="wheel">
          <div style="font-weight:800;text-align:center">How do you want to feel<br><small>(next)</small></div>
        </div>
        <select id="feel-next" class="select">
          <option value="">Select one…</option>
          <option>Calm</option><option>Energized</option><option>Grateful</option>
          <option>Focused</option><option>Optimistic</option>
        </select>
        <button id="next2" class="btn">Next</button>
      </div>

      <div class="step">
        <label class="lead" for="note">One line for future-you</label>
        <textarea id="note" class="textarea" placeholder="Tiny action, reframe, or reminder…"></textarea>
        <button id="save" class="btn">Save Hi Session</button>
        <div id="toast" class="toast" aria-live="polite"></div>
      </div>
    </section>

    <section class="panel">
      <h2 class="h1" style="font-size:1.2rem">Recent Sessions</h2>
      <div id="entries" style="display:grid;gap:12px;margin-top:10px"></div>
    </section>
  </main>

  <!-- page logic (mock mode: localStorage) -->
  <script>
    const H = document.getElementById('app-header'); // header injected by assets/header.js

    // --- mock store (localStorage) ---
    const KEY = 'stayhi.sessions.v1';
    const STREAK_KEY = 'stayhi.streak.v1';
    const read = () => JSON.parse(localStorage.getItem(KEY) || '[]');
    const write = (a) => localStorage.setItem(KEY, JSON.stringify(a));
    const readStreak = () => JSON.parse(localStorage.getItem(STREAK_KEY) || '{"count":0,"last":""}');
    const writeStreak = (s) => localStorage.setItem(STREAK_KEY, JSON.stringify(s));

    // --- ui helpers ---
    const $ = s => document.querySelector(s);
    const dots = () => document.querySelectorAll('.dots .dot');
    const steps = () => document.querySelectorAll('.step');
    const barI = () => document.querySelector('.bar i');

    function setStep(n){
      steps().forEach((el,i)=>el.classList.toggle('on', i===n));
      dots().forEach((el,i)=>el.classList.toggle('on', i<=n));
      barI().style.width = ((n+1)/3*100)+'%';
    }

    function renderEntries() {
      const root = $('#entries');
      const list = read().slice().reverse();
      if (!list.length) { root.innerHTML = '<div class="toast">No sessions yet.</div>'; return; }
      root.innerHTML = list.map(it=>`
        <div class="panel" style="padding:12px 14px;margin:0">
          <strong>${it.now || '—'}</strong> → ${it.next || '—'}
          <span style="float:right;color:#aeb1cc">${new Date(it.ts).toLocaleString()}</span>
          <div style="color:#cfd2ea;margin-top:6px">${(it.note||'').replace(/[&<>]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))}</div>
        </div>`).join('');
    }

    function renderStreak() {
      const {count,last} = readStreak();
      $('#streaks').textContent = `Streak: ${count}   (last check-in: ${last || '—'})`;
    }

    // --- events ---
    $('#next1').onclick = ()=> {
      if (!$('#feel-now').value) return $('#toast').textContent='Pick how you feel now.';
      $('#toast').textContent='';
      setStep(1);
    };
    $('#next2').onclick = ()=> {
      if (!$('#feel-next').value) return $('#toast').textContent='Pick how you want to feel.';
      $('#toast').textContent='';
      setStep(2);
    };
    $('#save').onclick = ()=> {
      const now = $('#feel-now').value, next = $('#feel-next').value, note = $('#note').value.trim();
      if (!now || !next) return $('#toast').textContent='Finish the steps first.';
      const list = read(); list.push({ now, next, note, ts: Date.now() }); write(list);
      $('#note').value=''; setStep(0); renderEntries();
      $('#toast').textContent='Saved!';
      setTimeout(()=>$('#toast').textContent='',1500);
    };
    $('#checkin').onclick = ()=> {
      const s = readStreak();
      const today = new Date().toISOString().slice(0,10);
      if (s.last === today) { $('#mtoast').textContent='Already checked in today ✨'; return; }
      const y = new Date(Date.now()-86400000).toISOString().slice(0,10);
      s.count = (s.last === y) ? (s.count+1) : 1;
      s.last = today; writeStreak(s); renderStreak();
      $('#mtoast').textContent='Checked in!'; setTimeout(()=>$('#mtoast').textContent='',1500);
    };

    // --- init ---
    setStep(0); renderEntries(); renderStreak();
  </script>

  <!-- shared header (logo + nav) -->
  <script src="assets/header.js" defer></script>
</body>
</html>
