<!DOCTYPE html><!DOCTYPE html>

<html><html lang="en">

<head><head>

    <title>üî¨ WOZNIAK DIAGNOSTIC</title>    <meta charset="UTF-8">

    <style>    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        body { font-family: monospace; padding: 20px; background: #111; color: #0f0; }    <title>üî¨ Tesla-Grade Share Sheet Diagnostic</title>

        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }    <style>

        .pass { background: #002200; }        * { box-sizing: border-box; }

        .fail { background: #220000; color: #f00; }        body {

        .info { background: #001122; color: #00f; }            background: #0f1024;

    </style>            color: white;

    <!-- Same exact includes as main dashboard -->            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>            padding: 20px;

    <script src="assets/supabase-init.js"></script>            margin: 0;

    <script src="assets/wozniak-tracking-foundation.js"></script>        }

    <script src="assets/wozniak-ui-connectors.js"></script>        .diagnostic-section {

</head>            margin: 20px 0;

<body>            padding: 20px;

    <h1>üî¨ WOZNIAK SYSTEM DIAGNOSTIC</h1>            background: rgba(255,255,255,0.1);

    <div id="results"></div>            border-radius: 8px;

            border-left: 4px solid #4ECDC4;

    <!-- Test elements with same IDs as main dashboard -->        }

    <div id="hiMedal">Test Medallion</div>        .test-btn {

    <div id="todayCount">0</div>            background: #4ECDC4;

    <div id="totalCount">0</div>            color: #111;

    <div id="announceTxt">Test Rotator</div>            border: none;

            padding: 12px 24px;

    <script>            border-radius: 8px;

        const results = document.getElementById('results');            cursor: pointer;

                    font-weight: 600;

        function test(name, condition, info = '') {            margin: 5px;

            const div = document.createElement('div');        }

            div.className = `test ${condition ? 'pass' : 'fail'}`;        .error { color: #ff6b6b; }

            div.innerHTML = `${condition ? '‚úÖ' : '‚ùå'} ${name} ${info ? `<br>   ${info}` : ''}`;        .success { color: #4ecdc4; }

            results.appendChild(div);        .warning { color: #ffd93d; }

            console.log(`${condition ? '‚úÖ' : '‚ùå'} ${name}`, info);        #log { 

            return condition;            max-height: 400px; 

        }            overflow-y: auto; 

            background: rgba(0,0,0,0.3); 

        function info(name, value) {            padding: 15px; 

            const div = document.createElement('div');            border-radius: 5px; 

            div.className = 'test info';            font-family: monospace; 

            div.innerHTML = `‚ÑπÔ∏è ${name}: ${value}`;        }

            results.appendChild(div);        .diagnostic-grid {

            console.log(`‚ÑπÔ∏è ${name}:`, value);            display: grid;

        }            grid-template-columns: 1fr 1fr;

            gap: 20px;

        // Wait a moment for everything to load        }

        setTimeout(async () => {        @media (max-width: 768px) {

            console.log('üî¨ STARTING WOZNIAK DIAGNOSTIC...');            .diagnostic-grid { grid-template-columns: 1fr; }

                    }

            // FUNDAMENTAL QUESTION 1: Are the scripts loaded?    </style>

            test('Supabase CDN', !!window.supabase, `window.supabase exists: ${!!window.supabase}`);</head>

            test('Supabase Client', !!window.supabaseClient, `window.supabaseClient exists: ${!!window.supabaseClient}`);<body>

            test('Wozniak Foundation Function', typeof window.initializeWozniakTracking === 'function', `Type: ${typeof window.initializeWozniakTracking}`);    <h1>üî¨ Tesla-Grade Share Sheet Diagnostic</h1>

            test('Wozniak UI Function', typeof window.initializeWozniakUI === 'function', `Type: ${typeof window.initializeWozniakUI}`);    

                <div class="diagnostic-grid">

            // FUNDAMENTAL QUESTION 2: Can we get Supabase client?        <div class="diagnostic-section">

            let supa = null;            <h3>üß™ Module Loading Tests</h3>

            try {            <button class="test-btn" onclick="testModuleLoading()">Test Module Loading</button>

                supa = window.supabaseClient || window.sb || null;            <button class="test-btn" onclick="testDOMElements()">Test DOM Elements</button>

                test('Supabase Client Available', !!supa, `Client object: ${!!supa}`);            <button class="test-btn" onclick="testCSS()">Test CSS Loading</button>

            } catch (e) {            <button class="test-btn" onclick="forceInitShare()">Force Init Share Sheet</button>

                test('Supabase Client Available', false, `Error: ${e.message}`);        </div>

            }

        <div class="diagnostic-section">

            // FUNDAMENTAL QUESTION 3: Do DOM elements exist?            <h3>üéØ Functional Tests</h3>

            const hiMedal = document.getElementById('hiMedal');            <button class="test-btn" onclick="testClickability()">Test Button Clickability</button>

            const todayCount = document.getElementById('todayCount');            <button class="test-btn" onclick="testEventListeners()">Test Event Listeners</button>

            const totalCount = document.getElementById('totalCount');            <button class="test-btn" onclick="openTestSheet()">Open Share Sheet</button>

            const announceTxt = document.getElementById('announceTxt');            <button class="test-btn" onclick="clearLog()">Clear Log</button>

                    </div>

            test('DOM: hiMedal', !!hiMedal, `Element found: ${!!hiMedal}`);    </div>

            test('DOM: todayCount', !!todayCount, `Element found: ${!!todayCount}`);

            test('DOM: totalCount', !!totalCount, `Element found: ${!!totalCount}`);    <div class="diagnostic-section">

            test('DOM: announceTxt', !!announceTxt, `Element found: ${!!announceTxt}`);        <h3>üìä Diagnostic Log</h3>

        <div id="log"></div>

            // FUNDAMENTAL QUESTION 4: Can we call the database?    </div>

            if (supa) {

                try {    <!-- Load share sheet with explicit error handling -->

                    console.log('üî¨ Testing database call...');    <script type="module" onerror="logError('Module script failed to load')" src="components/hi-share-sheet/share-sheet.js"></script>

                    const { data, error } = await supa.rpc('get_global_stats');    <link rel="stylesheet" href="components/hi-share-sheet/share-sheet.css" onerror="logError('CSS failed to load')">

                    if (error) {

                        test('Database Call', false, `Error: ${error.message}`);    <script>

                    } else {        let logCount = 0;

                        test('Database Call', true, `Success! Data: ${JSON.stringify(data)}`);        

                        if (data && data[0]) {        function log(message, type = 'info') {

                            info('Hi Waves in DB', data[0].hi_waves);            logCount++;

                            info('Total His in DB', data[0].total_his);            const logEl = document.getElementById('log');

                            info('Total Users in DB', data[0].total_users);            const timestamp = new Date().toLocaleTimeString();

                        }            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';

                    }            

                } catch (e) {            logEl.innerHTML += `<div class="${className}">[${logCount}] ${timestamp}: ${message}</div>`;

                    test('Database Call', false, `Exception: ${e.message}`);            logEl.scrollTop = logEl.scrollHeight;

                }            console.log(`[${logCount}] ${message}`);

            }        }



            // FUNDAMENTAL QUESTION 5: Can we initialize Wozniak?        function logError(message) {

            if (supa && typeof window.initializeWozniakTracking === 'function') {            log(`‚ùå ERROR: ${message}`, 'error');

                try {        }

                    console.log('üî¨ Testing Wozniak initialization...');

                    const wozniakTracking = await window.initializeWozniakTracking(supa);        function logSuccess(message) {

                    test('Wozniak Tracking Init', !!wozniakTracking, `Foundation created: ${!!wozniakTracking}`);            log(`‚úÖ SUCCESS: ${message}`, 'success');

                            }

                    if (wozniakTracking && typeof window.initializeWozniakUI === 'function') {

                        const wozniakUI = await window.initializeWozniakUI(wozniakTracking);        function logWarning(message) {

                        test('Wozniak UI Init', !!wozniakUI, `UI created: ${!!wozniakUI}`);            log(`‚ö†Ô∏è WARNING: ${message}`, 'warning');

                                }

                        // FUNDAMENTAL QUESTION 6: Can we increment?

                        if (wozniakTracking) {        // üî¨ DIAGNOSTIC FUNCTIONS

                            try {

                                console.log('üî¨ Testing increment...');        function testModuleLoading() {

                                const result = await wozniakTracking.incrementHiWaves();            log('üß™ Testing module loading...');

                                test('Increment Test', !!result, `Result: ${result}`);            

                            } catch (e) {            // Check if module loaded

                                test('Increment Test', false, `Error: ${e.message}`);            const moduleScript = document.querySelector('script[src*="share-sheet.js"]');

                            }            log(`Module script element: ${!!moduleScript}`);

                        }            

                    }            // Check global functions

                } catch (e) {            log(`window.openHiShareSheet: ${typeof window.openHiShareSheet}`);

                    test('Wozniak Tracking Init', false, `Error: ${e.message}`);            

                }            // Check if class is available

            }            try {

                const testClass = window.HiShareSheet || eval('HiShareSheet');

            info('Diagnostic Complete', new Date().toLocaleTimeString());                log(`HiShareSheet class: ${typeof testClass}`);

                logSuccess('Module loading test complete');

        }, 1000);            } catch (e) {

    </script>                logError(`HiShareSheet class not accessible: ${e.message}`);

</body>            }

</html>        }

        function testDOMElements() {
            log('üß™ Testing DOM elements...');
            
            // Check if elements exist (they shouldn't yet)
            const elements = [
                'hi-share-backdrop',
                'hi-share-sheet', 
                'hi-save-private',
                'hi-share-anon',
                'hi-share-public'
            ];
            
            elements.forEach(id => {
                const el = document.getElementById(id);
                log(`Element #${id}: ${!!el ? 'EXISTS' : 'NOT FOUND'}`);
            });
            
            logSuccess('DOM elements test complete');
        }

        function testCSS() {
            log('üß™ Testing CSS loading...');
            
            const cssLink = document.querySelector('link[href*="share-sheet.css"]');
            log(`CSS link element: ${!!cssLink}`);
            
            if (cssLink) {
                log(`CSS href: ${cssLink.href}`);
                log(`CSS loaded: ${cssLink.sheet ? 'YES' : 'NO'}`);
                if (cssLink.sheet) {
                    log(`CSS rules count: ${cssLink.sheet.cssRules.length}`);
                }
            }
            
            logSuccess('CSS test complete');
        }

        function forceInitShare() {
            log('üîß Force initializing share sheet...');
            
            try {
                // Try to create and init manually
                if (window.HiShareSheet) {
                    const shareSheet = new window.HiShareSheet({ origin: 'test' });
                    shareSheet.init();
                    logSuccess('Manual initialization successful');
                } else {
                    logError('HiShareSheet class not available for manual init');
                }
            } catch (e) {
                logError(`Manual initialization failed: ${e.message}`);
            }
        }

        function testClickability() {
            log('üéØ Testing button clickability...');
            
            // First, try to open share sheet
            if (window.openHiShareSheet) {
                try {
                    window.openHiShareSheet('test', { prefilledText: 'Clickability test' });
                    log('Share sheet opened for clickability test');
                    
                    // Wait a moment, then test buttons
                    setTimeout(() => {
                        const buttons = [
                            'hi-save-private',
                            'hi-share-anon', 
                            'hi-share-public'
                        ];
                        
                        buttons.forEach(id => {
                            const btn = document.getElementById(id);
                            if (btn) {
                                // Check if button is clickable
                                const computedStyle = window.getComputedStyle(btn);
                                log(`Button #${id}:`);
                                log(`  - Display: ${computedStyle.display}`);
                                log(`  - Visibility: ${computedStyle.visibility}`);
                                log(`  - Pointer Events: ${computedStyle.pointerEvents}`);
                                log(`  - Z-Index: ${computedStyle.zIndex}`);
                                log(`  - Position: ${computedStyle.position}`);
                                
                                // Try to click programmatically
                                try {
                                    btn.click();
                                    logSuccess(`Button #${id} is programmatically clickable`);
                                } catch (e) {
                                    logError(`Button #${id} click failed: ${e.message}`);
                                }
                            } else {
                                logError(`Button #${id} not found in DOM`);
                            }
                        });
                    }, 1000);
                    
                } catch (e) {
                    logError(`Share sheet open failed: ${e.message}`);
                }
            } else {
                logError('openHiShareSheet not available for clickability test');
            }
        }

        function testEventListeners() {
            log('üéß Testing event listeners...');
            
            setTimeout(() => {
                const buttons = document.querySelectorAll('[id^="hi-share-"], [id^="hi-save-"]');
                log(`Found ${buttons.length} share buttons`);
                
                buttons.forEach((btn, index) => {
                    const events = ['click', 'mousedown', 'mouseup', 'touchstart'];
                    events.forEach(eventType => {
                        const listeners = getEventListeners ? getEventListeners(btn)[eventType] : 'DevTools needed';
                        log(`Button ${btn.id} ${eventType} listeners: ${listeners}`);
                    });
                });
                
                logSuccess('Event listener test complete');
            }, 1000);
        }

        function openTestSheet() {
            log('üìã Attempting to open share sheet...');
            
            if (window.openHiShareSheet) {
                logSuccess('openHiShareSheet function found');
                try {
                    window.openHiShareSheet('test', { prefilledText: 'Test diagnostic message' });
                    logSuccess('Share sheet opened successfully');
                } catch (e) {
                    logError(`Share sheet open failed: ${e.message}`);
                }
            } else {
                logError('openHiShareSheet function not found');
                
                // Try alternative approaches
                log('Trying alternative initialization...');
                
                setTimeout(() => {
                    if (window.openHiShareSheet) {
                        logSuccess('Function available after delay');
                        window.openHiShareSheet('test');
                    } else {
                        logError('Function still not available after delay');
                    }
                }, 100);
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logCount = 0;
            logSuccess('Log cleared');
        }

        // üöÄ AUTO-RUN DIAGNOSTICS
        document.addEventListener('DOMContentLoaded', () => {
            log('üü¢ DOM loaded - starting diagnostics...');
            
            setTimeout(() => {
                testModuleLoading();
                testCSS();
            }, 500);
            
            setTimeout(() => {
                log('üîÑ Running delayed tests...');
                testModuleLoading(); // Recheck after delay
            }, 3000);
        });

        // Global error handler
        window.addEventListener('error', (e) => {
            logError(`Global error: ${e.message} at ${e.filename}:${e.lineno}`);
        });

        // Module loading error handler
        window.addEventListener('unhandledrejection', (e) => {
            logError(`Unhandled promise rejection: ${e.reason}`);
        });

        logSuccess('Diagnostic system initialized');
    </script>
</body>
</html>